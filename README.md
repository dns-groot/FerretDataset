# Ferret Tests Dataset

This repository contains tests generated by [Ferret](https://github.com/dns-groot/Ferret) to test DNS nameserver implementations like Bind, NSD, Knot, PowerDNS, and others. Ferret is the first _automatic_ test generator for DNS nameserver implementation RFC compliance. The tests in this repository were used successfully to find multiple bugs, including crashes, in many famous open-source implementation. The list can be found in the Ferret GitHub README section &mdash; [Bugs Found :bug:](https://github.com/dns-groot/Ferret#bugs-found).


**[DNS OARC](https://indico.dns-oarc.net/event/38/) also tweeted about Ferret saying: ["The automation tool received great compliments from the DNS experts".](https://twitter.com/dnsoarc/status/1390497128825376770)**

------------------------------------
## Dataset Description

A test case in DNS consists of a query and a zone file. Zone files are highly structured objects with various syntactic and semantic well-formedness requirements, and the query must be related to the zone file for the test even to reach the core DNS name resolution logic.

Ferret _jointly_ generates zone files and the corresponding queries, does so in a way that is targeted towards covering many different RFC behaviors, and is applicable to black-box DNS implemenetations. The key insight underlying Ferret is using the existing RFCs to build a much simpler, logical model of DNS resolution and then use this model to guide test generation. More details can be found in Ferret's [Test Generation Module README.](https://github.com/dns-groot/Ferret/tree/main/TestGenerator)

The dataset is organized as follows:

<pre>
<a href="https://github.com/dns-groot/FerretDataset">FerretDataset</a>
├── <a href="ValidZoneFileTests">ValidZoneFileTests</a>
│   ├── <a href="ValidZoneFileTests/ZoneFiles">ZoneFiles</a>
│   │   ├── <a href="ValidZoneFileTests/ZoneFiles/0.txt">0.txt</a>
│   │   ├── <a href="ValidZoneFileTests/ZoneFiles/1.txt">1.txt</a>
│   │   ├── ...
│   │   └── <a href="ValidZoneFileTests/ZoneFiles/12673.txt">12673.txt</a>
│   └── <a href="ValidZoneFileTests/ExpectedResponses">ExpectedResponses</a>
│       ├── <a href="ValidZoneFileTests/ExpectedResponses/0.json">0.json</a>
│       ├── <a href="ValidZoneFileTests/ExpectedResponses/1.json">1.json</a>
│       ├── ...
│       └── <a href="ValidZoneFileTests/ExpectedResponses/12673.json">12673.json</a>
└── <a href="InvalidZoneFileTests">InvalidZoneFileTests</a>
    ├── <a href="InvalidZoneFileTests/FalseCond_1">FalseCond_1</a>
    │   ├── <a href="InvalidZoneFileTests/FalseCond_1/ZoneFiles">ZoneFiles</a>
    │   │   ├── <a href="InvalidZoneFileTests/FalseCond_1/ZoneFiles/0.txt">0.txt</a>
    │   │   ├── ...
    │   │   └── <a href="InvalidZoneFileTests/FalseCond_1/ZoneFiles/99.txt">99.txt</a>
    │   ├── <a href="InvalidZoneFileTests/FalseCond_1/PreprocessorOutputs">PreprocessorOutputs</a>
    │   │   ├── <a href="InvalidZoneFileTests/FalseCond_1/PreprocessorOutputs/0.json">0.json</a>
    │   │   ├── ...
    │   │   └── <a href="InvalidZoneFileTests/FalseCond_1/PreprocessorOutputs/99.json">99.json</a>
    │   ├── <a href="InvalidZoneFileTests/FalseCond_1/EquivalenceClassNames">EquivalenceClassNames</a>
    │   │   ├── <a href="InvalidZoneFileTests/FalseCond_1/EquivalenceClassNames/0.txt">0.txt</a>
    │   │   ├── ...
    │   │   └── <a href="InvalidZoneFileTests/FalseCond_1/EquivalenceClassNames/99.txt">99.txt</a>
    │   └── <a href="InvalidZoneFileTests/FalseCond_1/ExpectedResponses">ExpectedResponses</a>
    │       ├── <a href="InvalidZoneFileTests/FalseCond_1/ExpectedResponses/0.json">0.json</a>
    │       ├── ...
    │       └── <a href="InvalidZoneFileTests/FalseCond_1/ExpectedResponses/99.json">99.json</a>    
    ...
    └── <a href="InvalidZoneFileTests/FalseCond_9">FalseCond_9</a>
</pre>

### Valid Zone File Tests
Ferret generated <kbd>12,673</kbd> tests where the zone file in each test case follows the syntactic and semantic requirements mentioned in RFCs. All those zone files are in the [`ValidZoneFileTests/ZoneFiles`](ValidZoneFileTests/ZoneFiles) directory. 

The query that was jointly generated with each zone file is in the [`ValidZoneFileTests/ExpectedResponses`](ValidZoneFileTests/ExpectedResponses) directory, along with the responses for each query from four popular open-source DNS implementations &mdash; [Bind](https://gitlab.isc.org/isc-projects/bind9/-/tree/eeec53eb5da5c0968e099f01c6236127f9813a97), [Knot](https://gitlab.nic.cz/knot/knot-dns/-/tree/41d8c938bc0ca70d4fc19ab01e72a8fd39b6c1cc), [NSD](https://github.com/NLnetLabs/nsd/tree/019f683093fd94aaf8fee58bb1297c82eea887cc), and [PowerDNS](https://github.com/PowerDNS/pdns/tree/57ec75fc8a217ae01de314e17333e11d9dd16772). Each implementation link points to the code base at which it was cloned for response generation. 

The corresponding zone file and query file are named with the same name but with a different extension &mdash; <a href="ValidZoneFileTests/ZoneFiles/0.txt">0.txt</a> in [`ZoneFiles`](ValidZoneFileTests/ZoneFiles) is the zone file, and <a href="ValidZoneFileTests/ExpectedResponses/0.json">0.json</a> in [`ExpectedResponses`](ValidZoneFileTests/ExpectedResponses) is the corresponding query file along with the response from the above four implementations.

### Invalid Zone File Tests

While testing with valid zone files is critical, bugs can also lurk in implementations' handling of ill-formed zones. Ferret also generated zone files that violated one of the zone validity conditions systematically, and to test using such zone files, leveraged [GRoot](https://github.com/dns-groot/groot) to generate queries. We formulated [9 zone semantic validity conditions](https://github.com/dns-groot/Ferret/tree/main/TestGenerator#invalid-zone-file-tests) and Ferret generated 100 zone files with one of them violated, but the other eight satisfied.

[`InvalidZoneFileTests/FalseCond_1`](InvalidZoneFileTests/FalseCond_1) directory contains all the info related to the tests where the zone files in those tests violate validity condition one, but all the other conditions are satisfied. The subdirectories in it are:

- [`ZoneFiles`](InvalidZoneFileTests/FalseCond_1/ZoneFiles) - All the Ferret generated zone files that do not satisfy the first zone validity condition
- [`PreprocessorOutputs`](InvalidZoneFileTests/FalseCond_1/PreprocessorOutputs) - The output from checking each of the zone files with each implementation's preprocessor: <kbd>[named-checkzone](https://linux.die.net/man/8/named-checkzone)</kbd> for Bind, <kbd>[kzonecheck](https://www.knot-dns.cz/docs/2.5/html/man_kzonecheck.html)</kbd> for Knot, <kbd>[nsd-checkzone](https://www.nlnetlabs.nl/documentation/nsd/nsd-checkzone/)</kbd> for NSD, and <kbd>[pdnsutil](https://doc.powerdns.com/authoritative/manpages/pdnsutil.1.html)</kbd> for PowerDNS.
- [`EquivalenceClassNames`](InvalidZoneFileTests/FalseCond_1/EquivalenceClassNames/) - The query equivalence class names generated for zone files using [GRoot](https://github.com/dns-groot/groot). Ferret uses the names in these files as query names and pairs them with different query types to test the implementations with the invalid zone files.
- [`ExpectedResponses`](InvalidZoneFileTests/FalseCond_1/ExpectedResponses/) - The responses from the four implementations for the queries if the implementation's preprocessor accepted the zone file.

## LICENSE
The tests in this dataset repository are licensed under the [MIT License.](LICENSE)
